{% extends 'base.html' %}
{% block title %}Recommendations - Career Guidance AI{% endblock %}
{% block content %}
<div class="page-wrapper">
    <div class="p-4 mb-4 rounded-4 text-white" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);">
        <h4 class="fw-bold mb-1"><i class="bi bi-stars me-2"></i>Your Career Recommendations</h4>
        <p class="mb-0 opacity-75">
            <i class="bi bi-file-earmark-person me-1"></i>
            Ranked by: Projects &amp; Experience (40%) &middot; Skills (35%) &middot; Education (15%) &middot; Quiz Interest (10%)
        </p>
    </div>

    {% if careers %}
    <div class="row g-4">
        {% for career in careers %}
        {% set acc_id = loop.index %}
        <div class="col-lg-6">
            <div class="stat-card">
                <div class="d-flex align-items-center mb-3">
                    <div class="stat-icon me-3" style="background: var(--primary);">
                        <i class="bi bi-briefcase-fill"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-0" style="color: var(--dark);">{{ career.title }}</h5>
                        <span class="badge" style="background: var(--success); color: #fff;">Match: {{ career.match_score }}/10</span>
                        <div class="mt-1" style="width:140px;">
                            <div class="progress" style="height:6px; border-radius:4px;">
                                <div class="progress-bar" role="progressbar"
                                     style="width: {{ (career.match_score / 10 * 100)|int }}%; background: var(--success);"
                                     aria-valuenow="{{ (career.match_score / 10 * 100)|int }}"
                                     aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <p style="color: var(--gray); font-size: 0.9rem;">{{ career.description }}</p>

                <div class="mb-2">
                    <small class="text-muted d-block mb-1">Required Skills</small>
                    <span class="fw-medium">{{ career.required_skills }}</span>
                </div>

                <div class="mb-2">
                    <small class="text-muted d-block mb-1">Available Skills</small>
                    {% for skill in career.available_skills %}
                    <span class="badge me-1" style="background: rgba(6,214,160,0.15); color: var(--success);"><i class="bi bi-check-circle me-1"></i>{{ skill.title() }}</span>
                    {% else %}<span class="text-muted">None</span>{% endfor %}
                </div>

                <div class="mb-3">
                    <small class="text-muted d-block mb-1">Missing Skills</small>
                    {% for skill in career.missing_skills %}
                    <span class="badge me-1" style="background: rgba(239,71,111,0.15); color: var(--danger);"><i class="bi bi-x-circle me-1"></i>{{ skill.title() }}</span>
                    {% else %}<span class="text-muted">None</span>{% endfor %}
                </div>

                {% if career.missing_skills %}
                <div class="p-3 rounded-3 mb-3" style="background: rgba(255,209,102,0.08);">
                    <small class="fw-bold d-block mb-2"><i class="bi bi-book me-1" style="color: var(--warning);"></i>Courses for Missing Skills</small>
                    <ul class="list-unstyled mb-0" style="font-size: 0.85rem;">
                        {% for link in career.course_links %}
                        <li class="mb-1">
                            <span class="fw-semibold">{{ link.skill }}:</span>
                            <a href="{{ link.google }}" target="_blank" class="me-1"><i class="bi bi-google"></i></a>
                            <a href="{{ link.coursera }}" target="_blank" class="me-1">Coursera</a>
                            <a href="{{ link.udemy }}" target="_blank" class="me-1">Udemy</a>
                            <a href="{{ link.edx }}" target="_blank" class="me-1">edX</a>
                            <a href="{{ link.linkedin }}" target="_blank" class="me-1"><i class="bi bi-linkedin"></i></a>
                            <a href="{{ link.khan }}" target="_blank">Khan</a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if career.match_explanation %}
                <div class="p-3 rounded-3 mb-3" style="background: rgba(67,97,238,0.05);">
                    <small class="fw-bold d-block mb-1"><i class="bi bi-info-circle me-1" style="color: var(--primary);"></i>Match Explanation</small>
                    <ul class="mb-0" style="font-size: 0.85rem;">
                        {% for exp in career.match_explanation %}<li>{{ exp }}</li>{% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if career.project_ideas %}
                <div class="mb-3">
                    <small class="fw-bold d-block mb-2"><i class="bi bi-lightbulb me-1" style="color: var(--warning);"></i>Project Ideas</small>
                    <div class="accordion" id="accordion{{ acc_id }}">
                        {% for idea in career.project_ideas %}
                        <div class="accordion-item border-0 mb-1">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed py-2 px-3 rounded-3"
                                        style="font-size: 0.88rem; background: rgba(67,97,238,0.05);"
                                        type="button"
                                        data-bs-toggle="collapse"
                                        data-bs-target="#collapse{{ acc_id }}-{{ loop.index }}">
                                    <i class="bi bi-lightbulb me-2" style="color: var(--warning);"></i>{{ idea.title }}
                                </button>
                            </h2>
                            <div id="collapse{{ acc_id }}-{{ loop.index }}"
                                 class="accordion-collapse collapse"
                                 data-bs-parent="#accordion{{ acc_id }}">
                                <div class="accordion-body py-2 px-3">
                                    <ol class="mb-2" style="font-size: 0.85rem;">
                                        {% for step in idea.steps %}<li>{{ step }}</li>{% endfor %}
                                    </ol>
                                    <form method="POST" action="{{ url_for('add_project_from_idea') }}">
                                        <input type="hidden" name="title" value="{{ idea.title }}">
                                        <input type="hidden" name="description" value="{{ idea.steps|join(' | ') }}">
                                        <input type="hidden" name="skills" value="{{ career.required_skills }}">
                                        <button type="submit" class="btn btn-sm"
                                                style="background: var(--primary); color: #fff; border-radius: 8px; font-size: 0.8rem;">
                                            <i class="bi bi-plus-circle me-1"></i>Add to My Projects
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="d-flex flex-wrap gap-2 mt-3">
                    <!-- Add to Career Path -->
                    <a href="{{ url_for('start_plan', career_id=career.id) }}"
                       class="btn btn-sm fw-semibold"
                       style="background: var(--primary); color: #fff; border-radius: 10px;"
                       onclick="return confirm('Start the {{ career.title }} career plan? This will create milestones for you to track.')">
                        <i class="bi bi-plus-circle me-1"></i>Add to Career Path
                    </a>

                    <!-- View Career Path Details -->
                    <a href="{{ url_for('career_path', career_id=career.id) }}" class="btn btn-career-outline btn-sm">
                        <i class="bi bi-map me-1"></i>View Path Details
                    </a>

                    <!-- Save Career -->
                    <form method="POST" action="{{ url_for('save_career', career_id=career.id) }}" class="d-inline">
                        <button type="submit" class="btn btn-sm"
                                style="background: var(--success); color: #fff; border-radius: 10px; font-weight: 600;">
                            <i class="bi bi-bookmark-plus me-1"></i>Save
                        </button>
                    </form>

                    <!-- Track My Progress -->
                    <a href="{{ url_for('track_progress') }}" class="btn btn-career-outline btn-sm">
                        <i class="bi bi-bar-chart-steps me-1"></i>Track Progress
                    </a>

                    <!-- Interview Prep -->
                    <a href="{{ url_for('interview_prep', career_title=career.title|replace(' ', '-')) }}" class="btn btn-career-outline btn-sm">
                        <i class="bi bi-question-circle me-1"></i>Interview Prep
                    </a>
                </div>

                {% if career.avg_salary %}
                <div class="p-2 rounded-3 mt-2" style="background: rgba(6,214,160,0.08); font-size: 0.85rem;">
                    <i class="bi bi-currency-rupee" style="color: var(--success);"></i>
                    <strong>Avg. Salary:</strong>
                    <span style="color: var(--success);">&#8377;{{ career.avg_salary|int|default('N/A') }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-stars d-block"></i>
        <h5>No recommendations yet</h5>
        <p>Upload your resume and complete the interest quiz to get personalized career recommendations</p>
        <div class="d-flex gap-2 justify-content-center">
            <a href="{{ url_for('upload_resume') }}" class="btn btn-career btn-sm">Upload Resume</a>
            <a href="{{ url_for('interest_quiz') }}" class="btn btn-career-outline btn-sm">Take Quiz</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
