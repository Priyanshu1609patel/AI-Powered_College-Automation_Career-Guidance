{% extends 'base.html' %}
{% block title %}Upload Resume - Career Guidance AI{% endblock %}
{% block content %}
<div class="page-wrapper">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Upload Form -->
            <div class="stat-card mb-4">
                <div class="text-center mb-4">
                    <div class="stat-icon mx-auto mb-3" style="background: var(--secondary); width: 56px; height: 56px; font-size: 1.5rem;">
                        <i class="bi bi-upload"></i>
                    </div>
                    <h3 class="fw-bold" style="color: var(--dark);">Upload Your Resume</h3>
                    <p style="color: var(--gray);">Get AI-powered analysis and career recommendations</p>
                </div>
                {% if success %}
                <div class="alert alert-success py-2"><i class="bi bi-check-circle me-1"></i>Resume uploaded and parsed successfully!</div>
                {% endif %}
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="resume" class="form-label fw-bold">Select Resume (PDF or DOCX)</label>
                        <input type="file" class="form-control" id="resume" name="resume" accept=".pdf,.docx" required>
                    </div>
                    <button type="submit" class="btn btn-career w-100">
                        <i class="bi bi-cloud-upload me-2"></i>Upload & Analyze
                    </button>
                </form>
            </div>

            <!-- Analysis Results -->
            {% if analysis and score is not none %}
            <div class="stat-card mb-4">
                <div class="d-flex align-items-center mb-3">
                    <div class="stat-icon me-3" style="background: var(--primary);">
                        <i class="bi bi-file-earmark-person"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-0" style="color: var(--dark);">Resume Analysis</h5>
                        <span class="badge" style="background: var(--success); color: #fff; font-size: 1rem;">Score: {{ score }}/100</span>
                    </div>
                </div>
                <div class="row g-3">
                    {% for cat, vals in analysis_categories.items() %}
                    <div class="col-md-6">
                        <div class="p-3 rounded-3" style="background: rgba(67,97,238,0.04);">
                            <h6 class="fw-bold mb-2"><i class="bi bi-check2-circle me-1" style="color: var(--primary);"></i>{{ cat }}</h6>
                            {% if cat == 'Skills' %}
                            <div class="mb-2" style="font-size: 0.85rem;"><strong>Extracted:</strong> {{ analysis.skills or 'Not detected' }}</div>
                            {% elif cat == 'Education' %}
                            <div class="mb-2" style="font-size: 0.85rem;"><strong>Extracted:</strong> {{ analysis.education or 'Not detected' }}</div>
                            {% elif cat == 'Experience' %}
                            <div class="mb-2" style="font-size: 0.85rem;"><strong>Extracted:</strong> {{ analysis.experience or 'Not detected' }}</div>
                            {% endif %}
                            {% if vals.positive %}
                            <ul class="mb-1" style="font-size: 0.85rem; color: var(--success);">
                                {% for pos in vals.positive %}<li>{{ pos }}</li>{% endfor %}
                            </ul>
                            {% endif %}
                            {% if vals.issues %}
                            <ul class="mb-1" style="font-size: 0.85rem; color: var(--danger);">
                                {% for issue in vals.issues %}<li>{{ issue }}</li>{% endfor %}
                            </ul>
                            {% endif %}
                            {% if vals.solutions %}
                            <ul class="mb-0" style="font-size: 0.85rem; color: var(--primary);">
                                {% for sol in vals.solutions %}<li><strong>Tip:</strong> {{ sol }}</li>{% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if score < 100 and zipped_issues %}
                <div class="p-3 rounded-3 mt-3" style="background: rgba(239,71,111,0.06);">
                    <h6 class="fw-bold mb-2" style="color: var(--danger);"><i class="bi bi-exclamation-triangle me-1"></i>Areas for Improvement</h6>
                    <div class="table-card">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0" style="font-size: 0.85rem;">
                                <thead><tr><th>Category</th><th>Issue</th><th>Solution</th></tr></thead>
                                <tbody>
                                    {% for issue, solution, category in zipped_issues %}
                                    <tr><td>{{ category }}</td><td>{{ issue }}</td><td>{{ solution }}</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Uploaded Resumes -->
            <div class="stat-card">
                <h5 class="fw-bold mb-3" style="color: var(--dark);"><i class="bi bi-file-earmark-text me-2"></i>Your Uploaded Resumes</h5>
                {% if resumes %}
                <form method="POST">
                    <div class="table-card">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead><tr><th>Select</th><th>Skills</th><th>Education</th><th>Experience</th><th>Action</th></tr></thead>
                                <tbody>
                                    {% for resume in resumes %}
                                    <tr>
                                        <td class="text-center"><input type="radio" name="selected_resume" value="{{ resume.id }}" {% if selected_resume_id == resume.id %}checked{% endif %} class="form-check-input"></td>
                                        <td style="font-size: 0.85rem;">{{ resume.skills }}</td>
                                        <td style="font-size: 0.85rem;">{{ resume.education }}</td>
                                        <td style="font-size: 0.85rem;">{{ resume.experience }}</td>
                                        <td>
                                            <form method="POST" action="{{ url_for('delete_resume', resume_id=resume.id) }}" style="display:inline;">
                                                <button type="submit" class="btn btn-sm" style="background: var(--danger); color: #fff; border-radius: 8px; font-size: 0.8rem;" onclick="return confirm('Delete this resume?');">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-career w-100 mt-3">
                        <i class="bi bi-stars me-2"></i>Use Selected Resume for Recommendations
                    </button>
                </form>
                {% else %}
                <div class="empty-state py-3">
                    <i class="bi bi-file-earmark d-block" style="font-size: 2rem;"></i>
                    <p class="mb-0">No resumes uploaded yet</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
